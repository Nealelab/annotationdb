

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; Hail</title>
  

  
  
    <link rel="shortcut icon" href="hail_logo_sq.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="navbar.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/rtd_modifications.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Hail" href="index.html"/>
        <link rel="next" title="Overview" href="overview.html"/>
        <link rel="prev" title="Contents" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>
  
  

</head>

<body class="wy-body-for-nav" role="document">

  <nav class="navbar navbar-default navbar-static-top" id="hail-navbar">
<div class="container-fluid" id="hail-container-fluid">
    <div class="navbar-header" id="hail-navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#hail-navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
   
      <a class="navbar-left" id="hail-navbar-brand" href="../index.html"><img alt="Hail" id="logo" src="hail-logo-cropped.png"></a>

    </div>

    <div class="collapse navbar-collapse" id="hail-navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
          <li id="home" class="nav-item"><a href="../index.html">HOME</a></li>
          <li id="docs" class="nav-item"><a href="index.html">DOCS</a></li>
          <li id="forum" class="nav-item"><a href="http://discuss.hail.is">FORUM</a></li>
          <li id="chat" class="nav-item dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">CHAT<span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-menu-left">
            <li><a class="dropdown-item" href="https://gitter.im/hail-is/hail">General</a></li>
            <li><a class="dropdown-item" href="https://gitter.im/hail-is/hail-dev">Developers</a></li>
          </ul>
        </li>
       <li id="code" class="nav-item"><a href="https://github.com/hail-is/hail">CODE</a></li>
      </ul>
    </div>
  </div>
</nav>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Hail
          

          
          </a>

          
            
            
              <div class="version">
                devel
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#building-and-running-hail">Building and running Hail</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-locally">Running locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-on-a-spark-cluster">Running on a Spark cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-on-a-cloudera-cluster">Running on a Cloudera Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-in-the-cloud">Running in the cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-with-other-versions-of-spark-2">Building with other versions of Spark 2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#blas-and-lapack">BLAS and LAPACK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-tests">Running the tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="exprlang.html">Expression Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="annotationdb.html">Annotation Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="other_resources.html">Other Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Hail</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/getting_started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<span class="target" id="sec-getting-started"></span><div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>You&#8217;ll need:</p>
<ul>
<li><p class="first">The <a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8 JDK</a>.</p>
</li>
<li><p class="first"><a class="reference external" href="http://spark.apache.org/downloads.html">Spark 2.0.2</a>. Hail should work with other versions of Spark 2, see below.</p>
</li>
<li><p class="first">Python 2.7 and IPython. We recommend the free <a class="reference external" href="https://www.continuum.io/downloads">Anaconda distribution</a>.</p>
</li>
<li><p class="first"><a class="reference external" href="http://cmake.org">CMake</a> and a C++ compiler that supports <code class="docutils literal"><span class="pre">-std=c++11</span></code> (we recommend at least GCC 4.7 or Clang 3.3).</p>
<p>On a Debian-based Linux OS like Ubuntu, run:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ sudo apt-get install g++ cmake
</pre></div>
</div>
<p>On Mac OS X, install Xcode, available through the App Store, for the C++ compiler.  <a class="reference external" href="http://cmake.org">CMake</a> can be downloaded from the CMake website or through <a class="reference external" href="http://brew.sh">Homebrew</a>.  To install with Homebrew, run</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ brew install cmake
</pre></div>
</div>
</li>
<li><p class="first">The Hail source code.  To clone the <a class="reference external" href="https://github.com/broadinstitute/hail">Hail repository</a> using <a class="reference external" href="https://git-scm.com/">Git</a>, run</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ git clone https://github.com/broadinstitute/hail.git
$ cd hail
</pre></div>
</div>
<p>You can also download the source code directly from <a class="reference external" href="https://github.com/broadinstitute/hail/archive/master.zip">Github</a>.</p>
<p>You may also want to install <a class="reference external" href="http://seaborn.pydata.org">Seaborn</a>, a Python library for statistical data visualization, using <code class="docutils literal"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">seaborn</span></code> or <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">seaborn</span></code>. While not technically necessary, Seaborn is used in the tutorial to make prettier plots.</p>
</li>
</ul>
<p>To install all dependencies for running locally on a fresh Ubuntu installation, use this <a class="reference external" href="https://github.com/hail-is/hail/wiki/Install-Hail-dependencies-on-a-fresh-Ubuntu-VM">script</a>.</p>
<p>The following commands are relative to the <code class="docutils literal"><span class="pre">hail</span></code> directory.</p>
<div class="section" id="building-and-running-hail">
<h2>Building and running Hail<a class="headerlink" href="#building-and-running-hail" title="Permalink to this headline">¶</a></h2>
<p>Hail may be built to run locally or on a Spark cluster. Running locally is useful for getting started, analyzing or experimenting with small datasets, and Hail development.</p>
<div class="section" id="running-locally">
<h3>Running locally<a class="headerlink" href="#running-locally" title="Permalink to this headline">¶</a></h3>
<p>The single command</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>$ ./gradlew shadowJar
</pre></div>
</div>
</div></blockquote>
<p>creates a Hail JAR file at <code class="docutils literal"><span class="pre">build/libs/hail-all-spark.jar</span></code>. The initial build takes time as <a class="reference external" href="https://gradle.org/">Gradle</a> installs all Hail dependencies.</p>
<p>Add the following environmental variables by filling in the paths to <strong>SPARK_HOME</strong> and <strong>HAIL_HOME</strong> below and exporting all four of them (consider adding them to your .bashrc):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ export SPARK_HOME=/path/to/spark
$ export HAIL_HOME=/path/to/hail
$ export PYTHONPATH=&quot;$PYTHONPATH:$HAIL_HOME/python:$SPARK_HOME/python:`echo $SPARK_HOME/python/lib/py4j*-src.zip`&quot;
$ export SPARK_CLASSPATH=$HAIL_HOME/build/libs/hail-all-spark.jar
</pre></div>
</div>
<p>Running <code class="docutils literal"><span class="pre">ipython</span></code> on the command line will open an interactive Python shell.</p>
<p>Here are a few simple things to try in order. To import the <code class="docutils literal"><span class="pre">hail</span></code> module and start a <a class="reference internal" href="hail.HailContext.html#hail.HailContext" title="hail.HailContext"><code class="xref py py-class docutils literal"><span class="pre">HailContext</span></code></a>, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hail</span> <span class="k">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hc</span> <span class="o">=</span> <span class="n">HailContext</span><span class="p">()</span>
</pre></div>
</div>
<p>To <a class="reference internal" href="hail.HailContext.html#hail.HailContext.import_vcf" title="hail.HailContext.import_vcf"><code class="xref py py-func docutils literal"><span class="pre">import</span></code></a> the included <em>sample.vcf</em> into Hail&#8217;s <strong>.vds</strong> format, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hc</span><span class="o">.</span><span class="n">import_vcf</span><span class="p">(</span><span class="s1">&#39;src/test/resources/sample.vcf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sample.vds&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To <a class="reference internal" href="hail.VariantDataset.html#hail.VariantDataset.split_multi" title="hail.VariantDataset.split_multi"><code class="xref py py-func docutils literal"><span class="pre">split</span></code></a> multi-allelic variants, compute a panel of <a class="reference internal" href="hail.VariantDataset.html#hail.VariantDataset.sample_qc" title="hail.VariantDataset.sample_qc"><code class="xref py py-func docutils literal"><span class="pre">sample</span></code></a> and <a class="reference internal" href="hail.VariantDataset.html#hail.VariantDataset.sample_qc" title="hail.VariantDataset.sample_qc"><code class="xref py py-func docutils literal"><span class="pre">variant</span></code></a> quality control statistics, write these statistics to files, and save an annotated version of the vds, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">vds</span> <span class="o">=</span> <span class="p">(</span><span class="n">hc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;sample.vds&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">split_multi</span><span class="p">()</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">sample_qc</span><span class="p">()</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">variant_qc</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vds</span><span class="o">.</span><span class="n">export_variants</span><span class="p">(</span><span class="s1">&#39;variantqc.tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;Variant = v, va.qc.*&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vds</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sample.qc.vds&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To <a class="reference internal" href="hail.VariantDataset.html#hail.VariantDataset.count" title="hail.VariantDataset.count"><code class="xref py py-func docutils literal"><span class="pre">count</span></code></a> the number of samples and variants, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">vds</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="hail.VariantDataset.html#hail.VariantDataset.summarize" title="hail.VariantDataset.summarize"><code class="xref py py-func docutils literal"><span class="pre">summarize</span></code></a> method produces a variety of useful statistics:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">vds</span><span class="o">.</span><span class="n">summarize</span><span class="p">()</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s get a feel for Hail&#8217;s powerful <span class="xref std std-ref">objects</span>, <a class="reference external" href="../reference.html#Annotations">annotation system</a>, and <a class="reference external" href="../reference.html#HailExpressionLanguage">expression language</a>. To print the current annotation schema and use these annotations to filter variants, samples, and genotypes, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sample annotation schema:&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">vds</span><span class="o">.</span><span class="n">sample_schema</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">variant annotation schema:&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">vds</span><span class="o">.</span><span class="n">variant_schema</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">vds</span><span class="o">.</span><span class="n">filter_variants_expr</span><span class="p">(</span><span class="s1">&#39;v.altAllele().isSNP() &amp;&amp; va.qc.gqMean &gt;= 20&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">filter_samples_expr</span><span class="p">(</span><span class="s1">&#39;sa.qc.callRate &gt;= 0.97 &amp;&amp; sa.qc.dpMean &gt;= 15&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">filter_genotypes</span><span class="p">(</span><span class="s1">&#39;let ab = g.ad[1] / g.ad.sum() in &#39;</span>
<span class="gp">... </span>                      <span class="s1">&#39;((g.isHomRef() &amp;&amp; ab &lt;= 0.1) || &#39;</span>
<span class="gp">... </span>                      <span class="s1">&#39; (g.isHet() &amp;&amp; ab &gt;= 0.25 &amp;&amp; ab &lt;= 0.75) || &#39;</span>
<span class="gp">... </span>                      <span class="s1">&#39; (g.isHomVar() &amp;&amp; ab &gt;= 0.9))&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sample.filtered.vds&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Try running <a class="reference internal" href="hail.VariantDataset.html#hail.VariantDataset.count" title="hail.VariantDataset.count"><code class="xref py py-meth docutils literal"><span class="pre">count()</span></code></a> on <em>sample.filtered.vds</em> to see how the numbers have changed. For further background and examples, continue to the <a class="reference internal" href="overview.html#sec-overview"><span class="std std-ref">Overview</span></a> and <a class="reference internal" href="api.html#sec-api"><span class="std std-ref">API reference</span></a>.</p>
<p>Note that during each run Hail writes a <code class="docutils literal"><span class="pre">hail.log</span></code> file in the current directory; this is useful to developers for debugging.</p>
</div>
<div class="section" id="running-on-a-spark-cluster">
<h3>Running on a Spark cluster<a class="headerlink" href="#running-on-a-spark-cluster" title="Permalink to this headline">¶</a></h3>
<p>Hail can run on any cluster that has Spark 2 installed. For instructions
specific to Google Cloud Dataproc clusters and Cloudera clusters, see below.</p>
<p>For all other Spark clusters, you will need to build Hail from the source
code. First, log onto the master node of the Spark cluster, and build a Hail JAR
and a zipfile of the Python code by running:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>$ ./gradlew shadowJar archiveZip
</pre></div>
</div>
</div></blockquote>
<p>Then set the following environment variables with values peculiar to your
cluster for <code class="docutils literal"><span class="pre">SPARK_HOME</span></code> and <code class="docutils literal"><span class="pre">HAIL_HOME</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ export SPARK_HOME=/path/to/spark/
$ export HAIL_HOME=/path/to/hail
$ export PYTHONPATH=&quot;$PYTHONPATH:$HAIL_HOME/build/distributions/hail-python.zip:$SPARK_HOME/python:$SPARK_HOME/python/lib/py4j-*-src.zip&quot;
</pre></div>
</div>
<p>You can open an IPython shell with the <code class="docutils literal"><span class="pre">ipython</span></code> command:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>$ ipython
</pre></div>
</div>
</div></blockquote>
<p>Within the interactive shell, check that you can successfully create a
<code class="docutils literal"><span class="pre">HailContext</span></code> by running the following commands. Note that you have to pass in
the existing <code class="docutils literal"><span class="pre">SparkContext</span></code> instance <code class="docutils literal"><span class="pre">sc</span></code> to the <code class="docutils literal"><span class="pre">HailContext</span></code>
constructor.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hail</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hc</span> <span class="o">=</span> <span class="n">hail</span><span class="o">.</span><span class="n">HailContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Files can be accessed from both Hadoop and Google Storage. If you&#8217;re running on Google&#8217;s Dataproc, you&#8217;ll want to store your files in Google Storage. In most on premises clusters, you&#8217;ll want to store your files in Hadoop.</p>
<p>To convert <em>sample.vcf</em> stored in Google Storage into Hail&#8217;s <strong>.vds</strong> format, run:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hc</span><span class="o">.</span><span class="n">import_vcf</span><span class="p">(</span><span class="s1">&#39;gs:///path/to/sample.vcf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;gs:///output/path/sample.vds&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>To convert <em>sample.vcf</em> stored in Hadoop into Hail&#8217;s <strong>.vds</strong> format, run:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hc</span><span class="o">.</span><span class="n">import_vcf</span><span class="p">(</span><span class="s1">&#39;/path/to/sample.vcf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/output/path/sample.vds&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>It is also possible to run Hail non-interactively, by passing a Python script to
<code class="docutils literal"><span class="pre">spark-submit</span></code>. In this case, it is not necessary to set any environment
variables.</p>
<p>For example,</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>$ spark-submit --jars build/libs/hail-all-spark.jar \
               --py-files build/distributions/hail-python.zip \
               hailscript.py
</pre></div>
</div>
</div></blockquote>
<p>runs the script <cite>hailscript.py</cite> (which reads and writes files from Hadoop):</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hail</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">hail</span><span class="o">.</span><span class="n">HailContext</span><span class="p">()</span>
<span class="n">hc</span><span class="o">.</span><span class="n">import_vcf</span><span class="p">(</span><span class="s1">&#39;/path/to/sample.vcf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/output/path/sample.vds&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="running-on-a-cloudera-cluster">
<h3>Running on a Cloudera Cluster<a class="headerlink" href="#running-on-a-cloudera-cluster" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.cloudera.com/documentation/spark2/latest/topics/spark2_installing.html">These instructions</a>
explain how to install Spark 2 on a Cloudera cluster. You should work on a
gateway node on the cluster that has the Hadoop and Spark packages installed on
it.</p>
<p>Once Spark is installed, running Hail on a Cloudera cluster is exactly the same
as above, except:</p>
<blockquote>
<div><ul>
<li><p class="first">On a Cloudera cluster, <code class="docutils literal"><span class="pre">SPARK_HOME</span></code> should be set as:
<code class="docutils literal"><span class="pre">SPARK_HOME=/opt/cloudera/parcels/SPARK2/lib/spark2</span></code>,</p>
</li>
<li><p class="first">On Cloudera, you can create an interactive Python shell using <code class="docutils literal"><span class="pre">pyspark2</span></code>:</p>
<blockquote>
<div><dl class="docutils">
<dt>$ pyspark2 &#8211;jars build/libs/hail-all-spark.jar </dt>
<dd><p class="first last">&#8211;py-files build/distributions/hail-python.zip &#8211;conf spark.hadoop.io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,is.hail.io.compress.BGzipCodec,org.apache.hadoop.io.compress.GzipCodec &#8211;conf spark.sql.files.openCostInBytes=1099511627776 &#8211;conf spark.sql.files.maxPartitionBytes=1099511627776 &#8211;conf spark.hadoop.mapreduce.input.fileinputformat.split.minsize=1099511627776 &#8211;conf spark.hadoop.parquet.block.size=1099511627776</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p class="first">Cloudera&#8217;s version of <code class="docutils literal"><span class="pre">spark-submit</span></code> is called <code class="docutils literal"><span class="pre">spark2-submit</span></code>.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="running-in-the-cloud">
<h3>Running in the cloud<a class="headerlink" href="#running-in-the-cloud" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://cloud.google.com/dataproc/">Google</a> and <a class="reference external" href="https://aws.amazon.com/emr/details/spark/">Amazon</a> offer optimized Spark performance
and exceptional scalability to tens of thousands of cores without the overhead
of installing and managing an on-prem cluster.</p>
<p>Hail publishes pre-built JARs for Google Cloud Platform&#8217;s Dataproc Spark
clusters. If you would prefer to avoid building Hail from source, learn how to
get started on Google Cloud Platform by reading this <a class="reference external" href="http://discuss.hail.is/t/using-hail-on-the-google-cloud-platform/80">forum post</a>.</p>
</div>
<div class="section" id="building-with-other-versions-of-spark-2">
<h3>Building with other versions of Spark 2<a class="headerlink" href="#building-with-other-versions-of-spark-2" title="Permalink to this headline">¶</a></h3>
<p>Hail should work with other versions of Spark 2.  To build against a
different version, such as Spark 2.1.0, modify the above
instructions as follows:</p>
<blockquote>
<div><ul class="simple">
<li>Set the Spark version in the gradle command</li>
</ul>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>$ ./gradlew -Dspark.version=2.1.0 shadowJar
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">SPARK_HOME</span></code> should point to an installation of the desired version of Spark, such as <em>spark-2.1.0-bin-hadoop2.7</em></li>
<li>The version of the Py4J ZIP file in the hail alias must match the version in <code class="docutils literal"><span class="pre">$SPARK_HOME/python/lib</span></code> in your version of Spark.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="blas-and-lapack">
<h2>BLAS and LAPACK<a class="headerlink" href="#blas-and-lapack" title="Permalink to this headline">¶</a></h2>
<p>Hail uses BLAS and LAPACK optimized linear algebra libraries. These should load automatically on recent versions of Mac OS X and Google Dataproc. On Linux, these must be explicitly installed; on Ubuntu 14.04, run</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ apt-get install libatlas-base-dev
</pre></div>
</div>
<p>If natives are not found, <code class="docutils literal"><span class="pre">hail.log</span></code> will contain the warnings</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Failed to load implementation from: com.github.fommil.netlib.NativeSystemLAPACK
Failed to load implementation from: com.github.fommil.netlib.NativeSystemBLAS
</pre></div>
</div>
<p>See <a class="reference external" href="http://github.com/fommil/netlib-java">netlib-java</a> for more information.</p>
</div>
<div class="section" id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this headline">¶</a></h2>
<p>Several Hail tests have additional dependencies:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.cog-genomics.org/plink2">PLINK 1.9</a></li>
<li><a class="reference external" href="http://www.well.ox.ac.uk/~gav/qctool">QCTOOL 1.4</a></li>
<li><a class="reference external" href="http://www.r-project.org/">R 3.3.1</a> with packages <code class="docutils literal"><span class="pre">jsonlite</span></code> and <code class="docutils literal"><span class="pre">logistf</span></code>, which depends on <code class="docutils literal"><span class="pre">mice</span></code> and <code class="docutils literal"><span class="pre">Rcpp</span></code>.</li>
</ul>
</div></blockquote>
<p>Other recent versions of QCTOOL and R should suffice, but PLINK 1.7 will not.</p>
<p>To execute all Hail tests, run</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ ./gradlew -Dspark.home=$SPARK_HOME test
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="overview.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Contents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Hail Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'devel',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../bootstrap.min.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
  
   

</body>
</html>